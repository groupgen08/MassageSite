<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ index.title }}</title>
  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/vision.css" />
</head>
<body class="page-vision">

  <header class="site-header">
    <div class="nav">
      <a class="nav-logo" href="index.html">The Fulcrum</a>
      <ul class="nav-list">
        <li><a href="index.html" class="active">Видение лидера</a></li>
        <li><a href="holistic.html">Холистический подход</a></li>
        <li><a href="apitherapy.html">Апитерапия</a></li>
      </ul>
      <button class="nav-toggle" aria-label="Открыть меню" aria-expanded="false">☰</button>
    </div>

    <nav class="side-nav" aria-hidden="true">
      <button class="side-close" aria-label="Закрыть меню">✕</button>
      <ul>
        <li><a href="index.html">Видение лидера</a></li>
        <li><a href="holistic.html">Холистический подход</a></li>
        <li><a href="apitherapy.html">Апитерапия</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <section class="hero">
      <img src="{{ index.hero.image }}" alt="{{ index.hero.alt }}" class="hero-image" />
      <div class="hero-text">
        <h1>{{ index.hero.h1 }}</h1>
        <p class="lead">{{ index.hero.lead }}</p>
      </div>
    </section>

    {# Открываем основную статью #}
    <article class="content">
      
      {% for block in index.content_blocks %}

        {# --- ОБЫЧНЫЕ БЛОКИ --- #}
        {% if block.type == 'h2' %}
           <h2>{{ block.text }}</h2>

        {% elif block.type == 'h3' %}
           <h3>{{ block.text }}</h3>

        {% elif block.type == 'paragraph' %}
           {# safe нужен, чтобы работали <b> внутри текста, если они есть #}
           <p>{{ block.text | safe }}</p>

        {% elif block.type == 'list' %}
           <ul>
             {% for item in block.items %}
               <li>{{ item | safe }}</li>
             {% endfor %}
           </ul>

        {# --- СЕКЦИЯ РЕГУЛЯЦИЯ (Магия смены контейнера) --- #}
        {% elif block.type == 'regulation_header' %}
           {# Если мы встретили заголовок Регуляции, закрываем article и открываем section #}
    </article> 
           
           <section class="regulation">
           <h2>{{ block.text }}</h2>

        {% elif block.type == 'regulation_card' %}
           {# Специальная верстка для карточек регуляции #}
           <div class="reg-block">
              <h3>{{ block.text }}</h3>
              <ul>
                {% for item in block.items %}
                  <li>{{ item | safe }}</li>
                {% endfor %}
              </ul>
           </div>

        {% endif %}

      {% endfor %}

      {# Проверяем: если последний блок был частью регуляции, нужно закрыть section.
         Иначе закрываем article (который мы могли закрыть выше, поэтому здесь нужна аккуратность). 
         
         Простой хак для Nunjucks: Браузер сам закроет незакрытые теги, но для порядка: 
      #}
      
      {# Если мы внутри секции регуляции, закрываем её #}
      {% if index.content_blocks | selectattr("type", "equalto", "regulation_header") | list | length > 0 %}
        </section>
      {% else %}
        </article>
      {% endif %}

      {# Автор выводится отдельно, если нужно #}
        {% if index.manifest_author %}
            <!-- <div class="container"> -->
                <p class="author">{{ index.manifest_author }}</p>
            <!-- </div> -->
        {% endif %}

  </main>

  <footer class="site-footer">
    <p>© The Fulcrum — Портал здоровья</p>
  </footer>

  <script src="script/menu.js"></script>

</body>
</html>